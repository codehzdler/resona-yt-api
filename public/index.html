<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Resona Registration</title>
  <style>
    body { font-family: sans-serif; background: #f5f5f5; padding: 30px; }
    .form-container { background: white; padding: 20px; border-radius: 10px; max-width: 400px; margin: auto; box-shadow: 0 0 10px rgba(0,0,0,0.1);}
    input { width: 100%; padding: 8px; margin: 8px 0; border-radius: 5px; border: 1px solid #ccc;}
    button { padding: 10px 20px; border-radius: 5px; border: none; background: #4caf50; color: white; cursor: pointer;}
    button:hover { background: #45a049; }
    .status { margin-top: 10px; font-size: 0.9em; }
    a { color: #1a73e8; text-decoration: none; }
  </style>
</head>
<body>

  <div class="form-container">
    <h2>Register</h2>
    <form id="registerForm">
      <input type="email" id="email" placeholder="Email" required>
      <input type="password" id="password" placeholder="Password" required>
      <input type="password" id="confirmPassword" placeholder="Confirm Password" required>
      <input type="text" id="apiKey" placeholder="Your YouTube API Key" required>
      <button type="submit">Register</button>
    </form>
    <div class="status" id="status"></div>
    <p>Forgot password? <a href="reset.html">Reset here</a></p>
    <div class="mt-4">
      <h3>üìñ How to Get a YouTube API Key</h3>
      <ol>
        <li>Go to <a href="https://console.cloud.google.com/apis/library/youtube.googleapis.com" target="_blank">Google Cloud Console</a></li>
        <li>Enable YouTube Data API v3</li>
        <li>Create an API key</li>
        <li>Paste it here in the form</li>
      </ol>
      <p>üé• Video tutorial: <a href="https://youtu.be/LLAZUTbc97I?si=lhlFFjkCRZaaTjb8" target="_blank">Watch here</a></p>
    </div>
  </div>

  <!-- Supabase Library -->
  <script src="https://unpkg.com/@supabase/supabase-js"></script>
  <!-- Your Supabase initialization -->
  <script src="supabase.js"></script>

  <script>
    const form = document.getElementById("registerForm");
    const status = document.getElementById("status");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      status.textContent = "‚è≥ Checking passwords‚Ä¶";

      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      const confirmPassword = document.getElementById("confirmPassword").value;
      const apiKey = document.getElementById("apiKey").value;

      if(password !== confirmPassword){
        status.textContent = "‚ùå Passwords do not match";
        return;
      }

      status.textContent = "‚è≥ Verifying API key‚Ä¶";

      // Simple test of API key (check quota endpoint)
      try {
        const res = await fetch(`https://www.googleapis.com/youtube/v3/videos?part=id&id=dQw4w9WgXcQ&key=${apiKey}`);
        const data = await res.json();
        if(data.error){
          status.textContent = "‚ùå Invalid YouTube API key";
          return;
        }
      } catch(err){
        status.textContent = "‚ùå Error testing API key";
        return;
      }

      status.textContent = "‚è≥ Registering user‚Ä¶";

      // Insert into Supabase
      try {
        const { error } = await supabase.from("user_accounts").insert([{ email, password, api_key: apiKey }]);
        if(error){
          if(error.code === "23505") status.textContent = "‚ùå Email already in use";
          else status.textContent = "‚ùå " + error.message;
          return;
        }
        status.textContent = "‚úÖ Registration successful! Thank you for contributing your API key!";
        form.reset();
      } catch(err){
        status.textContent = "‚ùå " + err.message;
      }
    });
  </script>

</body>
</html>
