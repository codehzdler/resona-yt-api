<h2>Submit Your YouTube API Key</h2>
<p>
  Don't have an API key? Watch this tutorial: 
  <a href="https://youtu.be/LLAZUTbc97I?si=lhlFFjkCRZaaTjb8" target="_blank">How to Get a YouTube API Key</a>
</p>
<p>
  Or go directly to Google Cloud Console: 
  <a href="https://console.cloud.google.com/" target="_blank">Google Cloud Console</a>
</p>

<form id="keyForm">
  <input type="text" id="userKey" placeholder="Enter your API key" required />
  <button type="submit">Submit</button>
</form>

<div id="activationContainer" style="display:none; margin-top:10px;">
  <p>Your activation key:</p>
  <input type="text" id="activationKey" value="1reso5na-6hzn9" readonly />
  <button id="copyButton">Copy Key</button>
</div>

<p id="keyMessage"></p>

<script type="module">
  import { supabase } from './lib/supabase.js';

  const keyForm = document.getElementById('keyForm');
  const keyMessage = document.getElementById('keyMessage');
  const activationContainer = document.getElementById('activationContainer');
  const copyButton = document.getElementById('copyButton');
  const activationKeyInput = document.getElementById('activationKey');

  keyForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    const apiKey = document.getElementById('userKey').value.trim();
    if (!apiKey) return;

    const res = await fetch('/api/submit-key', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ apiKey })
    });

    const data = await res.json();
    if (data.message && data.message.includes('successfully')) {
      keyMessage.textContent = 'API key verified successfully!';
      activationContainer.style.display = 'block';
    } else {
      keyMessage.textContent = data.error || data.message;
      activationContainer.style.display = 'none';
    }

    keyForm.reset();
  });

  copyButton.addEventListener('click', () => {
    activationKeyInput.select();
    activationKeyInput.setSelectionRange(0, 99999); // mobile support
    document.execCommand('copy');
    alert('Activation key copied!');
  });
</script>
